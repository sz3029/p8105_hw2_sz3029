---
title: "HW 2"
author: Shihui Zhu sz3029
output: github_document
---

```{r package, message=FALSE}
# This chunk loads all the packages used in this homework
library(readxl)
library(tidyverse)
```

# Problem 1

## Read in Mr. Trash Wheel dataset and clean the data
```{r}
mr_trash_wheel_df <- 
  read_excel("data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
  sheet = 1,
  range = "A2:N408") %>%
  janitor::clean_names() %>%
  drop_na() %>%
  mutate(sports_balls = round(sports_balls, digits = 0)) # Round the number of sports balls to nearest integer
```

## Read in precipitation data for 2018
```{r}
preci_18_df <- 
  read_excel("data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
  sheet = 5,
  range = "A2:B14") %>%
  janitor::clean_names() %>%
  mutate(year = "2018") # Add year variable
```

## Read in precipitation data for 2019
```{r}
preci_19_df <- 
  read_excel("data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
  sheet = 4,
  range = "A2:B14") %>%
  janitor::clean_names() %>%
  mutate(year = "2019") # Add year variable
```

## Combine precipitation data for 2018 and 2019, and convert month to character variable
```{r}
preci_18_and_19_df <- 
  bind_rows(preci_18_df, preci_19_df) %>%
  mutate(month = month.name[month]) # convert month to character variable
```

## Description for Mr. Trash Wheel dataset

The Mr. Trash Wheel dataset contains `r length(names(mr_trash_wheel_df))` variables:
`r names(mr_trash_wheel_df)`. Columns from `plastic_bottles` to `homes_powered` indicate
different kinds of trash collected at Mr. Trash Wheel. 
The dataset contains `r nrow(mr_trash_wheel_df)` rows 
and `r ncol(mr_trash_wheel_df)` columns of observations. The data were 
collected from years `r unique(dplyr::pull(mr_trash_wheel_df, year))`. The total weight 
of trash collected over the 6 years was `r sum(dplyr::pull(mr_trash_wheel_df, weight_tons))` 
tons, with a total volume of `r sum(dplyr::pull(mr_trash_wheel_df, volume_cubic_yards))` 
cubic yards. A table displaying the values of the key variables for each year is shown below: 

`r mr_trash_wheel_df %>% dplyr::group_by(year) %>% select(year, weight_tons:homes_powered) %>% skimr::skim() %>% knitr::kable()`

The dataset includes information about different kinds of trash collected. For example, the total number of sports balls collected in 2019 was `r mr_trash_wheel_df %>% dplyr::filter(str_detect(year, "2019")) %>% dplyr::pull(sports_balls) %>% sum()`, 
and the median number is `r mr_trash_wheel_df %>% dplyr::filter(str_detect(year, "2019")) %>% dplyr::pull(sports_balls) %>% median()`. 

## Description for precipitation data for 2018 and 2019

The precipitation dataset contains data of total precipitation per month from 2018 to 2019. It has `r length(names(preci_18_and_19_df))` variables: `r names(preci_18_and_19_df)`, with a dimension of `r nrow(preci_18_and_19_df)` rows and `r ncol(preci_18_and_19_df)` columns. The total precipitation in year 2018 was `r preci_18_and_19_df %>% dplyr::filter(str_detect(year, "2018")) %>% dplyr::pull(total) %>% sum()`. 


# Problem 2
## Clean data in pols-month.csv
* break up the variable `mon` into integer variables `year`, `month`, and `day`
* replace month number with month name
* create a `president` variable taking values `gop` and `dem`, and remove `prez_dem` and `prez_gop`
* remove the `day` variable
```{r pols, message=FALSE}
pols_month_df <- read_csv("fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day"), convert = TRUE) %>% # convert the format of date
  mutate(month = month.name[month], # convert month name to string
         president = recode(prez_dem, `1` = "dem", `0` = "gop")) %>% # create president variable and assign value
  select(-day, -prez_dem, -prez_gop) # remove unnecessary columns
```

## Clean data in snp.csv
Use similar process as above:

* break up the variable `date` into integer variables `year`, `month`, and `day`
* replace month number with month name
* remove `day` variable
```{r snp, message=FALSE}
snp_df <- read_csv("fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names() %>%
  mutate(date = as.Date(as.character(date),"%m/%d/%y"),
         date = as.Date(ifelse(date > Sys.Date(),
                        format(date, "19%y-%m-%d"),
                        format(date)))) %>% 
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>% # reformat the date
  select(year, month, everything()) %>% # make year and month as the leading columns
  mutate(month = month.name[month]) %>% # convert month name to string
  select(-day) # remove day column
```

## Tidy unemployment data

* switching from “wide” to “long” format
* match the variable names

```{r unemploy, message=FALSE}
unemploy_df <- read_csv("fivethirtyeight_datasets/unemployment.csv") %>%
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment_percent"
  ) %>%
  mutate(month = match(month, month.abb),
         month = month.name[month]) %>% # reformat the date
  janitor::clean_names()
```
## Merge the datasets

* merge `snp` into `pols` via `left_join()`
* merge with `unemployment` data
```{r}
pols_snp_df <-
  left_join(pols_month_df, snp_df, by = c("year", "month"))
pols_snp_unemployment_df <-
  left_join(pols_snp_df, unemploy_df, by = c("year", "month"))
```

## Descriptions for datasets: `pols`, `snp`, `unemployment`, and `pols_snp_unemployment` merged from those







